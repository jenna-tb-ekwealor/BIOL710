---
title: "Introduction to ANOVA"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE, message=FALSE}
library(BIOL710)
library(learnr)
library(learnrhash)
library(tidyverse)
library(gradethis)
library(infer)
tutorial_options(
  exercise.checker = gradethis::grade_learnr
)
knitr::opts_chunk$set(echo = FALSE)

# Prepare data
plant_growth <- PlantGrowth
```

## Getting Started

In this pre-lab, you'll explore **ANOVA** (Analysis of Variance), a method used to compare the means of **more than two groups**. If you're asking:

> Does *any* group differ in its mean compared to the others?

...then ANOVA is your tool!


### Load packages

We’ll be using the **tidyverse** and **infer** packages to explore and analyze our data.

```{r load-packages, exercise = TRUE}
library(tidyverse)
library(infer)
```


### The data

We’ll use the classic `PlantGrowth` dataset. It contains the dry weight of plants grown under three different conditions:

- `ctrl`: control group
- `trt1`: treatment 1
- `trt2`: treatment 2

Take a look:

```{r view-data, exercise = TRUE}
head(plant_growth)
```


### How many plants per group?
Use `count()` to find out:

```{r count-groups, exercise = TRUE}
plant_growth %>%
  count(group)
```


## Visualizing group differences

Let’s make a boxplot to compare the plant weights across the three groups.

```{r boxplot, exercise = TRUE}
ggplot(plant_growth, aes(x = group, y = weight)) +
  geom_boxplot()
```

What does this plot suggest about the group means?

```{r boxplot-mcq}
question("Based on the boxplot, which groups are most likely to be significantly different from each other, and why?",
  answer("trt2 is significantly different from both other groups because the quartiles do not overlap", correct = TRUE),
  answer("trt1 is significantly different from ctrl because trt1 has more outliers"),
  answer("ctrl is different from trt2 because the boxes are the same width but have different medians"),
  answer("None of the groups are likely to be different because the whiskers all touch"),
  allow_retry = TRUE
)
```

```{r plot-question}
question("Which group *appears* to have the highest median weight?",
  answer("ctrl"),
  answer("trt1"),
  answer("trt2", correct = TRUE),
  allow_retry = TRUE
)
```


## Summary statistics

Let’s compute the **mean and standard deviation** for each group.

```{r group-stats, exercise = TRUE}
plant_growth %>%
  group_by(group) %>%
  summarise(
    mean_weight = mean(weight),
    sd_weight = sd(weight)
  )
```

## One-Way ANOVA using R

Let’s run a one-way ANOVA using the `aov()` function in R.

The general syntax is:

```r
aov(response_variable ~ explanatory_variable, data = dataset)
```

Think carefully: which variable is the outcome you're measuring (response)? Which defines the groups (explanatory)?

Fill in the blanks to run your ANOVA:

```{r fill-anova, exercise = TRUE}
aov_result <- aov(___ ~ ___, data = plant_growth)
summary(___)
```

```{r fill-anova-solution}
aov_result <- aov(weight ~ group, data = plant_growth)
summary(aov_result)
```

```{r fill-anova-check}
gradethis::grade_this_code()
```

::: {.info-box}
The F statistic is calculated as the ratio of the mean square for the groups (between-group variability) to the mean square for the residuals (within-group variability). A larger F indicates greater separation between groups.
:::

### Fill in the blanks: Run your own ANOVA

```{r fill-anova, exercise = TRUE}
aov_result <- aov(___ ~ ___, data = plant_growth)
summary(___)
```

```{r fill-anova-solution}
aov_result <- aov(weight ~ group, data = plant_growth)
summary(aov_result)
```

```{r fill-anova-check}
gradethis::grade_this_code()
```


## Interpreting the output

Which values in the ANOVA output correspond to:
- Degrees of freedom for groups and residuals?
- Mean square for groups and error?
- The F value?
- The p-value?

*Write your interpretation as a comment in the code chunk below. Make sure to "run code" to submit your response!*

```{r interpretation, exercise = TRUE}
# insert interpretation here
```


```{r rsquared-setup, include=FALSE}
aov_result <- aov(weight ~ group, data = plant_growth)
summary(aov_result)
```

## Estimate R-squared

R² is the proportion of variation explained by the grouping variable:

```{r rsquared, exercise = TRUE}
r_squared <- 1 - (sum(aov_result$residuals^2) / sum((plant_growth$weight - mean(plant_growth$weight))^2))
r_squared
```

*Write your interpretation of the R² value as a comment in the code chunk below. Make sure to "run code" to submit your response!*

```{r rsquared-interpretation, exercise = TRUE}
# insert interpretation of R-squared here
```{r rsquared, exercise = TRUE}
r_squared <- 1 - (sum(aov_result$residuals^2) / sum((plant_growth$weight - mean(plant_growth$weight))^2))
r_squared
```


## Submit checkpoint

```{r context="server"}
learnrhash::encoder_logic(strip_output = TRUE)
```

```{r encode, echo=FALSE}
learnrhash::encoder_ui(
  ui_before = div(strong("Submit your hash in the form below."), br(), br()),
  ui_after  = learnrhash::iframe_ui(
    src = "https://docs.google.com/forms/d/e/1FAIpQLSf0FKvlOHfchtSxwIpD9Jo65sDlTjeokodsO1vP64rLcVYZ2A/viewform?usp=header",
    width = "900px", height = "1000px"
  )
)
```

* * *

<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
</a>
<br />
This work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
  Creative Commons Attribution-ShareAlike 4.0 International License
</a> and adapted for use by your instructor.
